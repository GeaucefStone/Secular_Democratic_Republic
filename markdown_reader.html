<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Markdown Reader</title>
		<style>
			a:link {
				color: #7393B3;
			}

			a:visited {
				color: #8A6EAA;
			}

			body {
				font-family: Arial, sans-serif;
				background: #000000;
				margin: 0;
				padding: 20px;
			}
			.container {
				max-width: 800px;
				margin: auto;
				background: #1a365d;
				padding: 20px;
				border-radius: 5px;
				box-shadow: 0 0 10px rgba(0,0,0,0.1);
			}
			#fileInput {
				display: none;
			}
			.browse-btn {
				background: #007cba;
				border: 2px #003d5c;
				border-radius: 5px;
				display: block;
				padding: 40px 20px;
				font-size: 18px;
				color: white;
				cursor: pointer;
				text-align: center;
				margin-bottom: 10px;
				width: 100%;
				transition: all 0.3s ease;
			}
			.browse-btn:hover {
				background: #005a87;
				border-color: #002a40;
			}
			.browse-btn.drag-over {
				background: #005a87;
				border: 2px #ffffff;
				border-color: #ffffff;
			}

			.instructions {
				background: #2d3748;
				border: 1px solid #4a5568;
				border-radius: 5px;
				color: #e2e8f0;
				margin-bottom: 20px;
				padding: 15px;
				text-align: center;
			}
			.folder-hint {
				color: #d63031;
				font-size: 14px;
				font-weight: bold;
				margin: 10px 0;
				text-align: center;
			}
			.current-file {
				background: #2d3748;
				border: 1px solid #4a5568;
				border-radius: 5px;
				color: #007cba;
				font-weight: bold;
				margin: 15px 0;
				padding: 10px;
				text-align: center;
			}

			#markdown-output {
				line-height: 1.5;
				padding: 20px;
				background: #fafafa;
				border-radius: 5px;
				min-height: 200px;
				margin-top: 20px;
			}
			#markdown-output table {
				border-collapse: collapse;
				width: 100%;
				margin: 12px 0;
			}
			#markdown-output th, #markdown-output td {
				border: 1px solid #ddd;
				padding: 7px 10px;
				text-align: left;
			}
			#markdown-output th {
				background: #2d3748;
				color: white;
			}
			#markdown-output blockquote {
				border-left: 4px solid #000;
				font-style: italic;
				margin: 12px 0;
				padding: 10px 16px;
				background: #f0f0f0;
			}
			#markdown-output hr {
				border: 0;
				background: #000;
				height: 1px;
				margin: 18px 0;
			}
			/* Balanced spacing for all elements */
			#markdown-output h1 { 
				margin: 16px 0 10px 0;
				line-height: 1.3;
			}
			#markdown-output h2 { 
				margin: 14px 0 9px 0;
				line-height: 1.3;
			}
			#markdown-output h3 { 
				margin: 13px 0 8px 0;
				line-height: 1.3;
			}
			#markdown-output h4, 
			#markdown-output h5, 
			#markdown-output h6 {
				margin: 12px 0 8px 0;
				line-height: 1.3;
			}
			#markdown-output p {
				margin: 8px 0;
				line-height: 1.5;
			}
			#markdown-output ul {
				margin: 8px 0;
				padding-left: 20px;
			}
			#markdown-output li {
				margin: 4px 0;
				line-height: 1.4;
			}
			#markdown-output br {
				display: none;
			}
			/* Add a little extra space between major sections */
			#markdown-output h1 + p,
			#markdown-output h2 + p,
			#markdown-output h3 + p,
			#markdown-output h4 + p,
			#markdown-output h5 + p,
			#markdown-output h6 + p {
				margin-top: 10px;
			}
			/* Extra space after tables and blockquotes */
			#markdown-output table + p,
			#markdown-output blockquote + p,
			#markdown-output table + ul,
			#markdown-output blockquote + ul {
				margin-top: 10px;
			}
			::selection {
				color: black;
				background: orange;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1 style="color: white;">ðŸ“„ Markdown Reader</h1>

			<div class="instructions">
				<p><strong>Tip:</strong> Your Markdown files are within the same folder as this HTML file.</p>
				<p>When the file dialog opens, navigate to this folder to find your files quickly.</p>
				<p><strong>Supported:</strong> .md, .markdown, .txt files</p>
				<p><strong>Shortcut:</strong> Ctrl+O to open files quickly</p>
			</div>

			<button class="browse-btn" id="browseBtn" onclick="document.getElementById('fileInput').click()">
				<div style="font-size: 48px; margin-bottom: 10px;">ðŸ“‚</div>
				<div>Click to Open or Drag & Drop Markdown Files</div>
				<div style="font-size: 14px; color: #cce7ff; margin-top: 10px;">
				.md, .markdown, .txt files
				</div>
			</button>

			<input type="file" id="fileInput" accept=".md,.markdown,.txt" />

			<div class="folder-hint" id="folderHint">
			ðŸ’¡ Look for the folder containing this HTML file
			</div>

			<div id="currentFile" class="current-file"></div>

			<div id="markdown-output">
				<p style="text-align: center; color: #999;">
				Select a Markdown file to view its formatted content.
				</p>
			</div>
		</div>

		<script>
			// Focus on bold, italic (underscores only), and links
			function processBold(text) {
				return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
			}

			function processItalic(text) {
				// Use underscores only for italics - won't conflict with bullets
				return text.replace(/_(.*?)_/g, '<em>$1</em>');
			}

			function processLinks(text) {
				return text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
			}

			// Main function that applies processing in correct order
			function processInlineMarkdown(text) {
				return processLinks(processItalic(processBold(text)));
			}

			// Function to parse markdown tables
			function parseTable(lines, startIndex) {
				let tableLines = [];
				let i = startIndex;
    
				// Collect all table rows until we hit a non-table line
				while (i < lines.length && lines[i].trim().includes('|')) {
					tableLines.push(lines[i]);
					i++;
				}
    
				if (tableLines.length < 2) return { html: '', newIndex: startIndex };
    
				let html = '<table>';
				let hasHeader = false;
    
				for (let j = 0; j < tableLines.length; j++) {
					let line = tableLines[j].trim();
					// Remove leading and trailing pipes
					if (line.startsWith('|')) line = line.substring(1);
					if (line.endsWith('|')) line = line.substring(0, line.length - 1);
	
					let cells = line.split('|').map(cell => cell.trim());
        	
					if (cells.length === 0 || cells.every(cell => cell === '')) continue;
        	
					// Check if this is a separator row
					let isSeparator = cells.every(cell => /^:?-+:?$/.test(cell));

					if (isSeparator) {
						// Skip separator row - it's just for markdown formatting
						continue;
					}
        
					html += '<tr>';

					for (let k = 0; k < cells.length; k++) {
						if (j === 0 && !hasHeader) {
							// First non-separator row is header
							html += '<th>' + processInlineMarkdown(cells[k]) + '</th>';
						} else {
							// Data row
							html += '<td>' + processInlineMarkdown(cells[k]) + '</td>';
						}
					}
        
					html += '</tr>';
	
					if (j === 0) {
						hasHeader = true;
					}
				}

				html += '</table>';
				return { html: html, newIndex: i - 1 };
			}

			function parseMarkdown(md) {
				let inSolidList = false;
				let inHollowList = false;
				let lines = md.split('\n');
				let result = [];
    
				for (let i = 0; i < lines.length; i++) {
					let line = lines[i];

					// Check for table (must have at least 2 lines with pipes)
					if (line.trim().includes('|') && !line.trim().startsWith('-') && !line.trim().startsWith('*')) {
						// Look ahead to see if this is part of a table
						let tableLinesCount = 1;
						for (let j = i + 1; j < lines.length; j++) {
							if (lines[j].trim().includes('|') && !lines[j].trim().startsWith('-') && !lines[j].trim().startsWith('*')) {
							tableLinesCount++;
						} else {
							break;
						}
					}

					if (tableLinesCount >= 2) {
						const tableResult = parseTable(lines, i);
						if (tableResult.html) {
							result.push(tableResult.html);
							i = tableResult.newIndex;
							continue;
						}
					}
				}
        
				// Check for solid bullet list item (-)
				if (line.trim().startsWith('- ')) {
					if (!inSolidList) {
						result.push('<ul style="list-style-type: disc;">');
						inSolidList = true;
					}
					let listContent = processInlineMarkdown(line.trim().substring(2));
					result.push('<li>' + listContent + '</li>');
				}
 
				// Check for hollow bullet list item (*)
				else if (line.trim().startsWith('* ')) {
					if (!inHollowList) {
						result.push('<ul style="list-style-type: circle;">');
						inHollowList = true;
					}
					let listContent = processInlineMarkdown(line.trim().substring(2));
					result.push('<li>' + listContent + '</li>');
				} 
				else {
					// Close any open lists
					if (inSolidList) {
						result.push('</ul>');
						inSolidList = false;
					}
					if (inHollowList) {
						result.push('</ul>');
						inHollowList = false;
					}
            
				// Process non-list lines
					if (line.trim()) {
						let processedLine = line.trim();

						// Handle block elements first
						if (processedLine.startsWith('> ')) {
							processedLine = '<blockquote>' + processInlineMarkdown(processedLine.substring(2)) + '</blockquote>';
						} else if (processedLine.startsWith('# ')) {
							processedLine = '<h1>' + processInlineMarkdown(processedLine.substring(2)) + '</h1>';
						} else if (processedLine.startsWith('## ')) {
							processedLine = '<h2>' + processInlineMarkdown(processedLine.substring(3)) + '</h2>';
						} else if (processedLine.startsWith('### ')) {
							processedLine = '<h3>' + processInlineMarkdown(processedLine.substring(4)) + '</h3>';
						} else if (processedLine.startsWith('#### ')) {
							processedLine = '<h4>' + processInlineMarkdown(processedLine.substring(5)) + '</h4>';
						} else if (processedLine.startsWith('##### ')) {
							processedLine = '<h5>' + processInlineMarkdown(processedLine.substring(6)) + '</h5>';
						} else if (processedLine.startsWith('###### ')) {
							processedLine = '<h6>' + processInlineMarkdown(processedLine.substring(7)) + '</h6>';
						} else if (processedLine === '---') {
						// Horizontal line
							processedLine = '<hr>';
						} else {
							// Regular paragraph
							processedLine = '<p>' + processInlineMarkdown(processedLine) + '</p>';
						}
							result.push(processedLine);
						}
					}
				}

				// Close any open lists
				if (inSolidList) {
					result.push('</ul>');
				}
				if (inHollowList) {
					result.push('</ul>');
				}

				return result.join('\n');
			}

			// Function to handle file processing (used by both file input and drag & drop)
			function handleFile(file) {
				if (!file) {
					output.innerHTML = '<p style="text-align: center; color: #999;">Select a Markdown file to view its content.</p>';
					currentFile.textContent = '';
					return;
				}

				// Check if file is a supported type
				const supportedTypes = ['.md', '.markdown', '.txt'];
				const fileExtension = '.' + file.name.split('.').pop().toLowerCase();

				if (!supportedTypes.includes(fileExtension)) {
					output.innerHTML = '<p style="color: red; text-align: center;">Please select a Markdown file (.md, .markdown, .txt)</p>';
					currentFile.textContent = '';
					return;
				}

				// Show which file is currently open
				currentFile.textContent = `Viewing: ${file.name}`;
				folderHint.style.display = 'none';

				const reader = new FileReader();
				reader.onload = (e) => {
					output.innerHTML = parseMarkdown(e.target.result);
				};
				reader.onerror = () => {
					output.innerHTML = '<p style="color: red;">Error reading file</p>';
					currentFile.textContent = '';
				};
				reader.readAsText(file);
			}

			// Event listeners and variables
			const fileInput = document.getElementById('fileInput');
			const output = document.getElementById('markdown-output');
			const currentFile = document.getElementById('currentFile');
			const folderHint = document.getElementById('folderHint');
			const browseBtn = document.getElementById('browseBtn');

			// File input event listener
			fileInput.addEventListener('change', (event) => {
				handleFile(event.target.files[0]);
			});

			// Drag and drop event listeners for button
			browseBtn.addEventListener('dragover', (e) => {
				e.preventDefault();
				browseBtn.classList.add('drag-over');
			});

			browseBtn.addEventListener('dragleave', (e) => {
				e.preventDefault();
				browseBtn.classList.remove('drag-over');
			});

			browseBtn.addEventListener('drop', (e) => {
				e.preventDefault();
				browseBtn.classList.remove('drag-over');

				const files = e.dataTransfer.files;
				if (files.length > 0) {
					handleFile(files[0]);
				}
			});

			// Auto-focus the button for keyboard accessibility
			window.addEventListener('load', function() {
				browseBtn.focus();
			});

			document.addEventListener('keydown', (e) => {
				if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
					e.preventDefault();
					document.getElementById('fileInput').click();
				}
			});
		</script>
	</body>
</html>